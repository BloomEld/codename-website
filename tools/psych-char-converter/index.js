(()=>{var e=document.getElementById("input"),t=document.getElementById("output"),a=document.getElementById("dropzone"),n=document.getElementById("file"),r=document.getElementById("save"),i=document.getElementById("file-name");function o(e,t){var a=document.createElement("a");a.href=URL.createObjectURL(e),a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)}function l(e){e.preventDefault(),e.stopPropagation()}r.addEventListener("click",(e=>{e.preventDefault();var a,n=t.value.trim();""!=n?(a=m?m.name.replace(/\.json$/,".xml"):"character.xml",o(new Blob([n],{type:"text/plain;charset=utf-8"}),a)):alert("Please paste your character data first!")})),["dragenter","dragover","dragleave","drop"].forEach((e=>{a.addEventListener(e,l,!1),document.body.addEventListener(e,l,!1)})),["dragenter","dragover"].forEach((e=>{a.addEventListener(e,d,!1)})),["dragleave","drop","dragend"].forEach((e=>{a.addEventListener(e,c,!1)})),a.addEventListener("drop",(e=>{f(e.dataTransfer.files)}),!1);var s=null;function d(){a.classList.add("highlight"),clearTimeout(s),s=setTimeout((()=>{c()}),1e3)}function c(){a.classList.remove("highlight")}var m=null;function f(a){var n="No file chosen",r=Array.from(a);if(r.length>0&&(a=r.filter((e=>e.type.startsWith("application/json"))),a.length>0)){var o=a[0];n=o.name,m=o;var l=new FileReader;l.onload=a=>{e.value=a.target.result;var n,r,i,o,l,s,d,c,m,f=(n=e.value,i=JSON.parse(n),o="<!DOCTYPE codename-engine-character>\n\x3c!-- Made with WizardMantis's Character Converter on https://codename-engine.com/ --\x3e\n<character",l=i.position,s=i.camera_position,d=i.sing_duration,c=i.scale,(m=i.image).startsWith("characters/")&&(m=m.slice(11)),o+=` sprite="${m}"`,o+=` icon="${i.healthicon}"`,o+=` color="${r=i.healthbar_colors,"#"+u(255&r[0],2)+u(255&r[1],2)+u(255&r[2],2)}"`,0!==l[0]&&(o+=` x="${l[0]}"`),0!==l[1]&&(o+=` y="${l[1]}"`),i.flip_x&&(o+=' flipX="true"'),i.no_antialiasing&&(o+=' antialiasing="false"'),0!==s[0]&&(o+=` camx="${s[0]}"`),0!==s[1]&&(o+=` camy="${s[1]}"`),4!==d&&(o+=` holdTime="${d}"`),1!==c&&(o+=` scale="${c}"`),o+=">\n",i.animations.forEach((e=>{o+=`\t<anim name="${e.anim}" anim="${e.name}"`;var t=e.offsets[0]/c,a=e.offsets[1]/c;(0!==t||0!==a)&&(o+=` x="${t}" y="${a}"`),24!==e.fps&&(o+=` fps="${e.fps}"`),e.loop&&(o+=' loop="true"'),0!==e.indices.length&&(o+=` indices="${((e,t=",")=>{if(0===e.length)return"";for(var a=[],n=0;n<e.length;){var r=e[n],i=r,o=0;if(n+1<e.length&&(e[n+1]===i+1?o=1:e[n+1]===i-1&&(o=-1)),0!==o)for(;n+1<e.length&&e[n+1]===i+o;)i=e[n+1],n++;r===i?a.push(r):r+o===i?a.push(r+","+i):a.push(r+".."+i),n++}return a.join(t)})(e.indices)}"`),o+="/>\n"})),o+="</character>");t.value=f},l.readAsText(o)}i.textContent=n}n.addEventListener("change",(()=>{f(n.files)}),!1);var h=document.getElementById("convert-folder");function u(e,t){for(var a=e.toString(16);a.length<t;)a="0"+a;return a}h.addEventListener("change",(()=>{var e=h.files,t=[],a=new JSZip,n=new Date;JSZip.defaults.date=new Date(n.getTime()-6e4*n.getTimezoneOffset());var r=e=>new Promise((t=>{var n=new FileReader;n.onload=n=>{a.file(e.name.replace(".json",".xml"),r(n.target.result)),t("wiz really likes furries")},n.readAsText(e)}));for(var i of e)i.name.includes(".json")&&t.push(r(i));Promise.all(t).then((()=>{a.generateAsync({type:"blob"}).then((e=>{(e=>{o(new Blob([e],{type:"application/octet-stream"}),"characters.zip")})(e)}))}))}))})();