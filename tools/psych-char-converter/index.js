(()=>{var a=document.getElementById("input"),r=document.getElementById("output"),t=document.getElementById("dropzone"),e=document.getElementById("file"),n=document.getElementById("save"),o=document.getElementById("file-name");function i(e){e.preventDefault(),e.stopPropagation()}n.addEventListener("click",function(e){var t,n;e.preventDefault(),""==a.value.trim()?alert("Please paste your character data first!"):(e="character.xml",null!=d&&(e=d.name.replace(/\.json$/,".xml")),t=r.value,e=e,t=new Blob([t],{type:"text/plain;charset=utf-8"}),(n=document.createElement("a")).href=URL.createObjectURL(t),n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n))}),["dragenter","dragover","dragleave","drop"].forEach(e=>{t.addEventListener(e,i,!1),document.body.addEventListener(e,i,!1)}),["dragenter","dragover"].forEach(e=>{t.addEventListener(e,c,!1)}),["dragleave","drop","dragend"].forEach(e=>{t.addEventListener(e,s,!1)}),t.addEventListener("drop",function(e){m(e.dataTransfer.files)},!1);var l=null;function c(){t.classList.add("highlight"),clearTimeout(l),l=setTimeout(()=>{s()},1e3)}function s(){t.classList.remove("highlight")}var d=null;function m(e){var t=Array.from(e);0<t.length&&0<(e=t.filter(e=>e.type.startsWith("application/json"))).length?(t=e[0],o.textContent=t.name,d=t,(e=new FileReader).onload=function(e){a.value=e.target.result;e=h(a.value);r.value=e},e.readAsText(t)):o.textContent="No file chosen"}e.addEventListener("change",()=>{m(e.files)},!1);var u=document.getElementById("convert-folder");function f(e,t){for(var n=e.toString(16);n.length<t;)n="0"+n;return n}function h(e){var t,n,a,r,o,i,e=JSON.parse(e),l="<!DOCTYPE codename-engine-character>\n\t\x3c!-- Made with WizardMantis's Character Converter on https://codename-engine.com/ --\x3e\n<character";return e.no_antialiasing&&(l+=' antialiasing="false"'),null!=e.image&&(e.image.startsWith("characters/")&&(e.image=e.image.replace("characters/","")),l+=' sprite="'+e.image+'"'),0!==e.position[0]&&(l+=' x="'+e.position[0]+'"'),0!==e.position[1]&&(l+=' y="'+e.position[1]+'"'),null!=e.healthicon&&(l+=' icon="'+e.healthicon+'"'),e.flip_x&&(l+=' flipX="true"'),null!=e.healthbar_colors&&(l+=' color="'+(i=e.healthbar_colors,i=4278190080|i[0]<<16|i[1]<<8|i[2],a=(i=0|i)>>24&255,r=i>>16&255,o=i>>8&255,i&=255,n=(n=t=!0)?"#":"",t&&a<255?n+f(a,2)+f(r,2)+f(o,2)+f(i,2):n+(r<<16|o<<8|i).toString(16))+'"'),0!==e.camera_position[0]&&(l+=' camx="'+e.camera_position[0]+'"'),0!==e.camera_position[1]&&(l+=' camy="'+e.camera_position[1]+'"'),4!==e.sing_duration&&(l+=' holdTime="'+e.sing_duration+'"'),1!==e.scale&&(l+=' scale="'+e.scale+'"'),l+=">\n",e.animations.forEach(function(e){l=(l=(l+="\t<anim")+' name="'+e.anim+'"')+' anim="'+e.name+'"',0!==e.offsets[0]&&(l+=' x="'+e.offsets[0]+'"'),0!==e.offsets[1]&&(l+=' y="'+e.offsets[1]+'"'),24!==e.fps&&(l+=' fps="'+e.fps+'"'),e.loop&&(l+=' loop="true"'),0!==e.indices.length&&(l+=' indices="'+((n,e=",")=>{if(0===n.length)return"";var a=[];let r=0;for(;r<n.length;){var o=n[r];let e=o,t=0;if(r+1<n.length&&(n[r+1]===e+1?t=1:n[r+1]===e-1&&(t=-1)),0!==t)for(;r+1<n.length&&n[r+1]===e+t;)e=n[r+1],r++;o===e?a.push(""+o):o+t===e?a.push(o+","+e):a.push(o+".."+e),r++}return a.join(e)})(e.indices)+'"'),l+="/>\n"}),l+="</character>"}u.addEventListener("change",function(){var t=u.files,n=[];var r=new JSZip,e=new Date,e=new Date(e.getTime()-6e4*e.getTimezoneOffset());JSZip.defaults.date=e;for(let e=0;e<t.length;e++){var a=t[e];a.name.includes(".json")&&n.push((a=>new Promise((t,e)=>{var n=new FileReader;n.onload=function(e){r.file(a.name.replace(".json",".xml"),h(e.target.result)),t("wiz really likes furries")},n.readAsText(a)}))(a))}Promise.all(n).then(e=>{r.generateAsync({type:"blob"}).then(function(e){var t,n;t=e,n="characters.zip",t=new Blob([e],{type:"application/octet-stream"}),(e=document.createElement("a")).href=URL.createObjectURL(t),e.download=n,document.body.appendChild(e),e.click(),document.body.removeChild(e)})})})})();