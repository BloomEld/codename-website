(()=>{var a=document.getElementById("input"),r=document.getElementById("output"),t=document.getElementById("dropzone"),e=document.getElementById("file"),n=document.getElementById("save"),o=document.getElementById("file-name");function i(e){e.preventDefault(),e.stopPropagation()}n.addEventListener("click",function(e){var t,n;e.preventDefault(),""==a.value.trim()?alert("Please paste your character data first!"):(e="character.xml",null!=s&&(e=s.name.replace(/\.json$/,".xml")),t=r.value,e=e,t=new Blob([t],{type:"text/plain;charset=utf-8"}),(n=document.createElement("a")).href=URL.createObjectURL(t),n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n))}),["dragenter","dragover","dragleave","drop"].forEach(e=>{t.addEventListener(e,i,!1),document.body.addEventListener(e,i,!1)}),["dragenter","dragover"].forEach(e=>{t.addEventListener(e,c,!1)}),["dragleave","drop","dragend"].forEach(e=>{t.addEventListener(e,d,!1)}),t.addEventListener("drop",function(e){u(e.dataTransfer.files)},!1);var l=null;function c(){t.classList.add("highlight"),clearTimeout(l),l=setTimeout(()=>{d()},1e3)}function d(){t.classList.remove("highlight")}var s=null;function u(e){var t=Array.from(e);0<t.length&&0<(e=t.filter(e=>e.type.startsWith("application/json"))).length?(t=e[0],o.textContent=t.name,s=t,(e=new FileReader).onload=function(e){a.value=e.target.result;e=p(a.value);r.value=e},e.readAsText(t)):o.textContent="No file chosen"}e.addEventListener("change",()=>{u(e.files)},!1);var m=document.getElementById("convert-folder");function h(e,t){for(var n=e.toString(16);n.length<t;)n="0"+n;return n}function f(e,t){t=Math.pow(10,t);return Math.round(e*t)/t}function p(e){var t,e=JSON.parse(e),a="<!DOCTYPE codename-engine-character>\n\x3c!-- Made with WizardMantis's Character Converter on https://codename-engine.com/ --\x3e\n<character",r=(e.no_antialiasing&&(a+=' antialiasing="false"'),null!=e.image&&(e.image.startsWith("characters/")&&(e.image=e.image.replace("characters/","")),a+=` sprite="${e.image}"`),0!==e.position[0]&&(a+=` x="${e.position[0]}"`),0!==e.position[1]&&(a+=` y="${e.position[1]}"`),null!=e.healthicon&&(a+=` icon="${e.healthicon}"`),e.flip_x&&(a+=' flipX="true"'),null!=e.healthbar_colors&&(a+=` color="${t=e.healthbar_colors,"#"+h(t[0],2)+h(t[1],2)+h(t[2],2)}"`),0!==e.camera_position[0]&&(a+=` camx="${e.camera_position[0]}"`),0!==e.camera_position[1]&&(a+=` camy="${e.camera_position[1]}"`),4!==e.sing_duration&&(a+=` holdTime="${e.sing_duration}"`),1!==e.scale&&(a+=` scale="${e.scale}"`),e.scale);return a+=">\n",e.animations.forEach(function(e){a+=`	<anim name="${e.anim}" anim="${e.name}"`;var t=f(e.offsets[0]/r,3),n=f(e.offsets[1]/r,3);0===t&&0===n||(a+=` x="${t}" y="${n}"`),24!==e.fps&&(a+=` fps="${e.fps}"`),e.loop&&(a+=' loop="true"'),0!==e.indices.length&&(a+=` indices="${((n,e=",")=>{if(0===n.length)return"";var a=[];let r=0;for(;r<n.length;){var o=n[r];let e=o,t=0;if(r+1<n.length&&(n[r+1]===e+1?t=1:n[r+1]===e-1&&(t=-1)),0!==t)for(;r+1<n.length&&n[r+1]===e+t;)e=n[r+1],r++;o===e?a.push(""+o):o+t===e?a.push(o+","+e):a.push(o+".."+e),r++}return a.join(e)})(e.indices)}"`),a+="/>\n"}),a+="</character>"}m.addEventListener("change",function(){var t=m.files,n=[];var r=new JSZip,e=new Date,e=new Date(e.getTime()-6e4*e.getTimezoneOffset());JSZip.defaults.date=e;for(let e=0;e<t.length;e++){var a=t[e];a.name.includes(".json")&&n.push((a=>new Promise((t,e)=>{var n=new FileReader;n.onload=function(e){r.file(a.name.replace(".json",".xml"),p(e.target.result)),t("wiz really likes furries")},n.readAsText(a)}))(a))}Promise.all(n).then(e=>{r.generateAsync({type:"blob"}).then(function(e){var t,n;t=e,n="characters.zip",t=new Blob([e],{type:"application/octet-stream"}),(e=document.createElement("a")).href=URL.createObjectURL(t),e.download=n,document.body.appendChild(e),e.click(),document.body.removeChild(e)})})})})();