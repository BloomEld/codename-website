(()=>{var e=document.getElementById("input"),t=document.getElementById("output"),a=document.getElementById("dropzone"),n=document.getElementById("file"),r=document.getElementById("save"),i=document.getElementById("file-name");function o(e,t){var a=document.createElement("a");a.href=URL.createObjectURL(e),a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)}function l(e){e.preventDefault(),e.stopPropagation()}r.addEventListener("click",(a=>{if(a.preventDefault(),""!=e.value.trim()){var n,r,i="character.xml";null!=m&&(i=m.name.replace(/\.json$/,".xml")),n=t.value,r=i,o(new Blob([n],{type:"text/plain;charset=utf-8"}),r)}else alert("Please paste your character data first!")})),["dragenter","dragover","dragleave","drop"].forEach((e=>{a.addEventListener(e,l,!1),document.body.addEventListener(e,l,!1)})),["dragenter","dragover"].forEach((e=>{a.addEventListener(e,c,!1)})),["dragleave","drop","dragend"].forEach((e=>{a.addEventListener(e,d,!1)})),a.addEventListener("drop",(e=>{u(e.dataTransfer.files)}),!1);var s=null;function c(){a.classList.add("highlight"),clearTimeout(s),s=setTimeout((()=>{d()}),1e3)}function d(){a.classList.remove("highlight")}var m=null;function u(a){var n=Array.from(a);if(n.length>0)if(a=n.filter((e=>e.type.startsWith("application/json"))),a.length>0){var r=a[0];i.textContent=r.name,m=r;var o=new FileReader;o.onload=a=>{e.value=a.target.result;var n=p(e.value);t.value=n},o.readAsText(r)}else i.textContent="No file chosen";else i.textContent="No file chosen"}n.addEventListener("change",(()=>{u(n.files)}),!1);var h=document.getElementById("convert-folder");function f(e,t){for(var a=e.toString(16);a.length<t;)a="0"+a;return a}function p(e){var t,a=JSON.parse(e),n="<!DOCTYPE codename-engine-character>\n\x3c!-- Made with WizardMantis's Character Converter on https://codename-engine.com/ --\x3e\n<character";a.no_antialiasing&&(n+=' antialiasing="false"'),null!=a.image&&(a.image.startsWith("characters/")&&(a.image=a.image.replace("characters/","")),n+=` sprite="${a.image}"`),0!==a.position[0]&&(n+=` x="${a.position[0]}"`),0!==a.position[1]&&(n+=` y="${a.position[1]}"`),null!=a.healthicon&&(n+=` icon="${a.healthicon}"`),a.flip_x&&(n+=' flipX="true"'),null!=a.healthbar_colors&&(n+=` color="${t=a.healthbar_colors,"#"+f(255&t[0],2)+f(255&t[1],2)+f(255&t[2],2)}"`),0!==a.camera_position[0]&&(n+=` camx="${a.camera_position[0]}"`),0!==a.camera_position[1]&&(n+=` camy="${a.camera_position[1]}"`),4!==a.sing_duration&&(n+=` holdTime="${a.sing_duration}"`),1!==a.scale&&(n+=` scale="${a.scale}"`);var r=a.scale;return n+=">\n",a.animations.forEach((e=>{n+=`\t<anim name="${e.anim}" anim="${e.name}"`;var t=e.offsets[0]/r,a=e.offsets[1]/r;(0!==t||0!==a)&&(n+=` x="${t}" y="${a}"`),24!==e.fps&&(n+=` fps="${e.fps}"`),e.loop&&(n+=' loop="true"'),0!==e.indices.length&&(n+=` indices="${((e,t=",")=>{if(0===e.length)return"";for(var a=[],n=0;n<e.length;){var r=e[n],i=r,o=0;if(n+1<e.length&&(e[n+1]===i+1?o=1:e[n+1]===i-1&&(o=-1)),0!==o)for(;n+1<e.length&&e[n+1]===i+o;)i=e[n+1],n++;r===i?a.push(`${r}`):r+o===i?a.push(`${r},${i}`):a.push(`${r}..${i}`),n++}return a.join(t)})(e.indices)}"`),n+="/>\n"})),n+="</character>"}h.addEventListener("change",(()=>{var e=h.files,t=[];function a(e){return new Promise((t=>{var a=new FileReader;a.onload=a=>{n.file(e.name.replace(".json",".xml"),p(a.target.result)),t("wiz really likes furries")},a.readAsText(e)}))}var n=new JSZip,r=new Date,i=new Date(r.getTime()-6e4*r.getTimezoneOffset());JSZip.defaults.date=i;for(var l=0;l<e.length;l++){var s=e[l];s.name.includes(".json")&&t.push(a(s))}Promise.all(t).then((()=>{n.generateAsync({type:"blob"}).then((e=>{(e=>{o(new Blob([e],{type:"application/octet-stream"}),"characters.zip")})(e)}))}))}))})();