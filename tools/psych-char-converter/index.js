(()=>{var a=document.getElementById("input"),r=document.getElementById("output"),t=document.getElementById("dropzone"),e=document.getElementById("file"),n=document.getElementById("save"),o=document.getElementById("file-name");function i(e){e.preventDefault(),e.stopPropagation()}n.addEventListener("click",function(e){var t,n;e.preventDefault(),""==a.value.trim()?alert("Please paste your character data first!"):(e="character.xml",null!=d&&(e=d.name.replace(/\.json$/,".xml")),t=r.value,e=e,t=new Blob([t],{type:"text/plain;charset=utf-8"}),(n=document.createElement("a")).href=URL.createObjectURL(t),n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n))}),["dragenter","dragover","dragleave","drop"].forEach(e=>{t.addEventListener(e,i,!1),document.body.addEventListener(e,i,!1)}),["dragenter","dragover"].forEach(e=>{t.addEventListener(e,c,!1)}),["dragleave","drop","dragend"].forEach(e=>{t.addEventListener(e,s,!1)}),t.addEventListener("drop",function(e){m(e.dataTransfer.files)},!1);var l=null;function c(){t.classList.add("highlight"),clearTimeout(l),l=setTimeout(()=>{s()},1e3)}function s(){t.classList.remove("highlight")}var d=null;function m(e){var t=Array.from(e);0<t.length&&0<(e=t.filter(e=>e.type.startsWith("application/json"))).length?(t=e[0],o.textContent=t.name,d=t,(e=new FileReader).onload=function(e){a.value=e.target.result;e=h(a.value);r.value=e},e.readAsText(t)):o.textContent="No file chosen"}e.addEventListener("change",()=>{m(e.files)},!1);var u=document.getElementById("convert-folder");function f(e,t){for(var n=e.toString(16);n.length<t;)n="0"+n;return n}function h(e){var t,e=JSON.parse(e),n="<!DOCTYPE codename-engine-character>\n\t\x3c!-- Made with WizardMantis's Character Converter on https://codename-engine.com/ --\x3e\n<character";return e.no_antialiasing&&(n+=' antialiasing="false"'),null!=e.image&&(e.image.startsWith("characters/")&&(e.image=e.image.replace("characters/","")),n+=` sprite="${e.image}"`),0!==e.position[0]&&(n+=` x="${e.position[0]}"`),0!==e.position[1]&&(n+=` y="${e.position[1]}"`),null!=e.healthicon&&(n+=` icon="${e.healthicon}"`),e.flip_x&&(n+=' flipX="true"'),null!=e.healthbar_colors&&(n+=` color="${t=e.healthbar_colors,"#"+f(t[0],2)+f(t[1],2)+f(t[2],2)}"`),0!==e.camera_position[0]&&(n+=` camx="${e.camera_position[0]}"`),0!==e.camera_position[1]&&(n+=` camy="${e.camera_position[1]}"`),4!==e.sing_duration&&(n+=` holdTime="${e.sing_duration}"`),1!==e.scale&&(n+=` scale="${e.scale}"`),n+=">\n",e.animations.forEach(function(e){n+=`	<anim name="${e.anim}" anim="${e.name}"`,0!==e.offsets[0]&&(n+=` x="${e.offsets[0]}"`),0!==e.offsets[1]&&(n+=` y="${e.offsets[1]}"`),24!==e.fps&&(n+=` fps="${e.fps}"`),e.loop&&(n+=' loop="true"'),0!==e.indices.length&&(n+=` indices="${((n,e=",")=>{if(0===n.length)return"";var a=[];let r=0;for(;r<n.length;){var o=n[r];let e=o,t=0;if(r+1<n.length&&(n[r+1]===e+1?t=1:n[r+1]===e-1&&(t=-1)),0!==t)for(;r+1<n.length&&n[r+1]===e+t;)e=n[r+1],r++;o===e?a.push(""+o):o+t===e?a.push(o+","+e):a.push(o+".."+e),r++}return a.join(e)})(e.indices)}"`),n+="/>\n"}),n+="</character>"}u.addEventListener("change",function(){var t=u.files,n=[];var r=new JSZip,e=new Date,e=new Date(e.getTime()-6e4*e.getTimezoneOffset());JSZip.defaults.date=e;for(let e=0;e<t.length;e++){var a=t[e];a.name.includes(".json")&&n.push((a=>new Promise((t,e)=>{var n=new FileReader;n.onload=function(e){r.file(a.name.replace(".json",".xml"),h(e.target.result)),t("wiz really likes furries")},n.readAsText(a)}))(a))}Promise.all(n).then(e=>{r.generateAsync({type:"blob"}).then(function(e){var t,n;t=e,n="characters.zip",t=new Blob([e],{type:"application/octet-stream"}),(e=document.createElement("a")).href=URL.createObjectURL(t),e.download=n,document.body.appendChild(e),e.click(),document.body.removeChild(e)})})})})();