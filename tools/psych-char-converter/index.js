(()=>{var n=document.getElementById("input"),a=document.getElementById("output"),t=document.getElementById("dropzone"),e=document.getElementById("file"),r=document.getElementById("save"),i=document.getElementById("file-name");function o(e,t){var n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}function l(e){e.preventDefault(),e.stopPropagation()}r.addEventListener("click",function(e){var t;e.preventDefault(),""==n.value.trim()?alert("Please paste your character data first!"):(e="character.xml",null!=m&&(e=m.name.replace(/\.json$/,".xml")),t=a.value,e=e,o(new Blob([t],{type:"text/plain;charset=utf-8"}),e))}),["dragenter","dragover","dragleave","drop"].forEach(e=>{t.addEventListener(e,l,!1),document.body.addEventListener(e,l,!1)}),["dragenter","dragover"].forEach(e=>{t.addEventListener(e,s,!1)}),["dragleave","drop","dragend"].forEach(e=>{t.addEventListener(e,d,!1)}),t.addEventListener("drop",function(e){u(e.dataTransfer.files)},!1);var c=null;function s(){t.classList.add("highlight"),clearTimeout(c),c=setTimeout(()=>{d()},1e3)}function d(){t.classList.remove("highlight")}var m=null;function u(e){var t=Array.from(e);0<t.length&&0<(e=t.filter(e=>e.type.startsWith("application/json"))).length?(t=e[0],i.textContent=t.name,m=t,(e=new FileReader).onload=function(e){n.value=e.target.result;e=p(n.value);a.value=e},e.readAsText(t)):i.textContent="No file chosen"}e.addEventListener("change",()=>{u(e.files)},!1);var f=document.getElementById("convert-folder");function h(e,t){for(var n=e.toString(16);n.length<t;)n="0"+n;return n}function p(e){var t,e=JSON.parse(e),a="<!DOCTYPE codename-engine-character>\n\x3c!-- Made with WizardMantis's Character Converter on https://codename-engine.com/ --\x3e\n<character",r=(e.no_antialiasing&&(a+=' antialiasing="false"'),null!=e.image&&(e.image.startsWith("characters/")&&(e.image=e.image.replace("characters/","")),a+=` sprite="${e.image}"`),0!==e.position[0]&&(a+=` x="${e.position[0]}"`),0!==e.position[1]&&(a+=` y="${e.position[1]}"`),null!=e.healthicon&&(a+=` icon="${e.healthicon}"`),e.flip_x&&(a+=' flipX="true"'),null!=e.healthbar_colors&&(a+=` color="${t=e.healthbar_colors,"#"+h(255&t[0],2)+h(255&t[1],2)+h(255&t[2],2)}"`),0!==e.camera_position[0]&&(a+=` camx="${e.camera_position[0]}"`),0!==e.camera_position[1]&&(a+=` camy="${e.camera_position[1]}"`),4!==e.sing_duration&&(a+=` holdTime="${e.sing_duration}"`),1!==e.scale&&(a+=` scale="${e.scale}"`),e.scale);return a+=">\n",e.animations.forEach(function(e){a+=`	<anim name="${e.anim}" anim="${e.name}"`;var t=e.offsets[0]/r,n=e.offsets[1]/r;0==t&&0==n||(a+=` x="${t}" y="${n}"`),24!==e.fps&&(a+=` fps="${e.fps}"`),e.loop&&(a+=' loop="true"'),0!==e.indices.length&&(a+=` indices="${((e,t=",")=>{if(0===e.length)return"";for(var n=[],a=0;a<e.length;){var r=e[a],i=r,o=0;if(a+1<e.length&&(e[a+1]===i+1?o=1:e[a+1]===i-1&&(o=-1)),0!==o)for(;a+1<e.length&&e[a+1]===i+o;)i=e[a+1],a++;n.push(r===i?""+r:r+o===i?r+","+i:r+".."+i),a++}return n.join(t)})(e.indices)}"`),a+="/>\n"}),a+="</character>"}f.addEventListener("change",()=>{var e=f.files,t=[];var r=new JSZip,n=new Date,n=new Date(n.getTime()-6e4*n.getTimezoneOffset());JSZip.defaults.date=n;for(var a=0;a<e.length;a++){var i=e[a];i.name.includes(".json")&&t.push((a=>new Promise((t,e)=>{var n=new FileReader;n.onload=function(e){r.file(a.name.replace(".json",".xml"),p(e.target.result)),t("wiz really likes furries")},n.readAsText(a)}))(i))}Promise.all(t).then(()=>{r.generateAsync({type:"blob"}).then(function(e){var t;t="characters.zip",o(new Blob([e],{type:"application/octet-stream"}),t)})})})})();